
def buildno = BUILD_NUMBER

pipeline {
    agent any
    tools {
        // Install the Maven version configured as "M3" and add it to the path.
        maven "maven3.6.3"
    }
    
    stages {
          
         stage('Build'){
             steps{
            sh "mvn clean package"
                  }
        }
        
        stage('Building image') {
            steps{
                script {
              sh "docker build -t vishwasahukar/mydockerrepo:${buildno} ."
                     }
                  }
              }
         stage('image push') {
             steps{
                script {
              sh "docker image push --all-tags vishwasahukar/mydockerrepo:${buildno} ."
                     }
                  }
              } 
    
    stage('scan'){
             steps{
            sh "grype vishwasahukar/mydockerrepo:${buildno}"
              }
        }
        
     }
}


